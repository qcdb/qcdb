<!-- 
#
# @BEGIN LICENSE
#
# Psi4: an open-source quantum chemistry software package
#
# Copyright (c) 2007-2017 The Psi4 Developers.
#
# The copyrights for code used from other parties are included in
# the corresponding files.
#
# This file is part of Psi4.
#
# Psi4 is free software; you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, version 3.
#
# Psi4 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public License along
# with Psi4; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#
# @END LICENSE
# -->






<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>qcdb.basisset.libmintsbasisset</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/psi4.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>

    
    
     
        <script src="../../../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../../../_static/cloud.base.js"></script>
    

    
     
        <script src="../../../_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="../../../_static/favicon-qcdb.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../../../index.html" title="Table Of Contents"
             accesskey="C"><i class="fa fa-book fa-lg"></i></a> &nbsp; &nbsp;</li>
    <li><a href="https://github.com/qcdb/qcdb/blob/master/README.md"><i class="fa fa-home fa-lg"></i></a></li>
    <li><a href="https://github.com/qcdb/qcdb"><i class="fa fa-github fa-lg"></i></a></li>
    <li><a href="http://forum.psicode.org"><i class="fa fa-comments-o fa-lg"></i></a></li>
    <li><a href="https://github.com/qcdb/qcdb/edit/master/docs/sphinx/_modules/qcdb/basisset/libmintsbasisset.rst"><i class="fa fa-pencil fa-lg"></i></a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li><a href="https://github.com/qcdb/qcdb/tree/0+untagged.1.gd9e156e">0+untagged.1.gd9e156e</a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li class="nav-item nav-item-0"><a href="../../../index.html">
        <span style="font-family: Optima, sans-serif;">QCDB</span>
        </a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>

          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>
        <li class="nav-item nav-item-this"><a href="">qcdb.basisset.libmintsbasisset</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for qcdb.basisset.libmintsbasisset</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">qcelemental</span> <span class="k">as</span> <span class="nn">qcel</span>

<span class="kn">from</span> <span class="nn">..driver</span> <span class="kn">import</span> <span class="n">pe</span>
<span class="kn">from</span> <span class="nn">..exceptions</span> <span class="kn">import</span> <span class="n">BasisSetNotFound</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">..molecule</span> <span class="kn">import</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">search_file</span>
<span class="kn">from</span> <span class="nn">.basislist</span> <span class="kn">import</span> <span class="n">corresponding_basis</span><span class="p">,</span> <span class="n">corresponding_zeta</span>
<span class="kn">from</span> <span class="nn">.libmintsbasissetparser</span> <span class="kn">import</span> <span class="n">Gaussian94BasisSetParser</span>
<span class="kn">from</span> <span class="nn">.libmintsgshell</span> <span class="kn">import</span> <span class="n">ShellInfo</span>

<span class="n">basishorde</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="BasisSet"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet">[docs]</a><span class="k">class</span> <span class="nc">BasisSet</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Basis set container class</span>
<span class="sd">    Reads the basis set from a checkpoint file object. Also reads the molecule</span>
<span class="sd">    from the checkpoint file storing the information in an internal Molecule class</span>
<span class="sd">    which can be accessed using molecule().</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># &lt;&lt;&lt; Globals &gt;&gt;&gt;</span>

    <span class="c1"># Has static information been initialized?</span>
    <span class="n">initialized_shared</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># Global arrays of x, y, z exponents (Need libmint for max ang mom)</span>
    <span class="n">LIBINT_MAX_AM</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># TODO</span>
    <span class="n">exp_ao</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>  <span class="c1"># LIBINT_MAX_AM</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>

        <span class="c1"># &lt;&lt;&lt; Basic BasisSet Information &gt;&gt;&gt;</span>

        <span class="c1"># The name of this basis set (e.g. &quot;BASIS&quot;, &quot;RI BASIS&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Array of gaussian shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shells</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Molecule object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Shell information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_basis_shell</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># &lt;&lt;&lt; Scalars &gt;&gt;&gt;</span>

        <span class="c1"># Number of atomic orbitals (Cartesian)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Number of basis functions (either cartesian or spherical)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The number of unique primitives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The number of shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The number of primitives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnprimitive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The maximum angular momentum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The maximum number of primitives in a shell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Whether the basis set is uses spherical basis functions or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># &lt;&lt;&lt; Arrays &gt;&gt;&gt;</span>

        <span class="c1"># The number of primitives (and exponents) in each shell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_prim_per_shell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The first (Cartesian) atomic orbital in each shell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_ao</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The first (Cartesian / spherical) basis function in each shell</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_basis_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Shell number to atomic center.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_center</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Which shell does a given (Cartesian / spherical) function belong to?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_to_shell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Which shell does a given Cartesian function belong to?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ao_to_shell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Which center is a given function on?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_center</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># How many shells are there on each center?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># What&#39;s the first shell on each center?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># The flattened lists of unique exponents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The flattened lists of unique contraction coefficients (normalized)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ucoefficients</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The flattened lists of unique contraction coefficients (as provided by the user)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The flattened lists of ERD normalized contraction coefficients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uerd_coefficients</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># The flattened list of Cartesian coordinates for each atom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># label/basis to number of core electrons mapping for ECPs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ecp_coreinfo</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Divert to constructor functions</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constructor_zero_ao_basis</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">BasisSet</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constructor_basisset_center</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Molecule</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constructor_role_mol_shellmap</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;BasisSet::constructor: Inappropriate configuration of constructor arguments&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Naive equality test. Haven&#39;t considered exp/coeff distribution among shells or AM&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">puream</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">PYnao</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">PYnbf</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_prim_per_shell</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">n_prim_per_shell</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ucoefficients</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ucoefficients</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">uexponents</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="c1"># &lt;&lt;&lt; Methods for Construction &gt;&gt;&gt;</span>

<div class="viewcode-block" id="BasisSet.initialize_singletons"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.initialize_singletons">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_singletons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize singleton values that are shared by all basis set objects.&quot;&quot;&quot;</span>
        <span class="c1"># Populate the exp_ao arrays</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LIBINT_MAX_AM</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="n">i</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="n">j</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">exp_ao</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">])</span></div>

<div class="viewcode-block" id="BasisSet.constructor_zero_ao_basis"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.constructor_zero_ao_basis">[docs]</a>    <span class="k">def</span> <span class="nf">constructor_zero_ao_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Constructs a zero AO basis set&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_shared</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_singletons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_shared</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Add a dummy atom at the origin, to hold this basis function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="c1"># Fill with data representing a single S function, at the origin, with 0 exponent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnprimitive</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uerd_coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_prim_per_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ucoefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_ao</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_basis_function</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ao_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;(Empty Basis Set)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ShellInfo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span><span class="p">,</span> <span class="s1">&#39;Cartesian&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>

<div class="viewcode-block" id="BasisSet.constructor_role_mol_shellmap"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.constructor_role_mol_shellmap">[docs]</a>    <span class="k">def</span> <span class="nf">constructor_role_mol_shellmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">shell_map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The most commonly used constructor. Extracts basis set name for *role*</span>
<span class="sd">        from each atom of *mol*, looks up basis and role entries in the</span>
<span class="sd">        *shell_map* dictionary, retrieves the ShellInfo objects and returns</span>
<span class="sd">        the BasisSet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">role</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">geometry</span><span class="p">()</span>  <span class="c1"># not used in libmints but this seems to be the intent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_basis_shell</span> <span class="o">=</span> <span class="n">shell_map</span>
        <span class="n">natom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">natom</span><span class="p">()</span>

        <span class="c1"># Singletons</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_shared</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_singletons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_shared</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># These will tell us where the primitives for [basis][symbol] start and end in the compact array</span>
        <span class="n">primitive_start</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">primitive_end</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># First, loop over the unique primitives, and store them</span>
        <span class="n">uexps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ucoefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">uoriginal_coefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">uerd_coefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rpowers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">symbolfirst</span><span class="p">,</span> <span class="n">symbolsecond</span> <span class="ow">in</span> <span class="n">shell_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">symbolfirst</span>
            <span class="n">basis_map</span> <span class="o">=</span> <span class="n">symbolsecond</span>
            <span class="n">primitive_start</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">primitive_end</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">basisfirst</span><span class="p">,</span> <span class="n">basissecond</span> <span class="ow">in</span> <span class="n">basis_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">basis</span> <span class="o">=</span> <span class="n">basisfirst</span>
                <span class="n">shells</span> <span class="o">=</span> <span class="n">basis_map</span><span class="p">[</span><span class="n">basis</span><span class="p">]</span>  <span class="c1"># symbol --&gt; label</span>
                <span class="n">primitive_start</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">basis</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>  <span class="c1"># symbol --&gt; label</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shells</span><span class="p">)):</span>
                    <span class="n">shell</span> <span class="o">=</span> <span class="n">shells</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">prim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()):</span>
                        <span class="n">rpowers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">rpower</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                        <span class="n">uexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                        <span class="n">ucoefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">coef</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                        <span class="n">uoriginal_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">original_coef</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                        <span class="n">uerd_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">erd_coef</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">primitive_end</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">basis</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>  <span class="c1"># symbol --&gt; label</span>

        <span class="c1"># Count basis functions, shells and primitives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnprimitive</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natom</span><span class="p">):</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">atom_entry</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">basisset</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>  <span class="c1"># symbol --&gt; label</span>
            <span class="n">shells</span> <span class="o">=</span> <span class="n">shell_map</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">basis</span><span class="p">]</span>  <span class="c1"># symbol --&gt; label</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shells</span><span class="p">)):</span>
                <span class="n">shell</span> <span class="o">=</span> <span class="n">shells</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">nprim</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYnprimitive</span> <span class="o">+=</span> <span class="n">nprim</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span> <span class="o">+=</span> <span class="n">shell</span><span class="o">.</span><span class="n">ncartesian</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span> <span class="o">+=</span> <span class="n">shell</span><span class="o">.</span><span class="n">nfunction</span><span class="p">()</span>

        <span class="c1"># Allocate arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_prim_per_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="c1"># The unique primitives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ucoefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uerd_coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uexps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ucoefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ucoefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uoriginal_coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uerd_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uerd_coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_ao</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_basis_function</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shells</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ao_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">natom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">natom</span>

        <span class="c1"># Now loop over all atoms, and point to the appropriate unique data</span>
        <span class="n">shell_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ao_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bf_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xyz_ptr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>  <span class="c1"># libmints seems to be always passing ShellInfo zeros, so following suit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natom</span><span class="p">):</span>
            <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">atom_entry</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">basis</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">basisset</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>  <span class="c1"># symbol --&gt; label</span>
            <span class="n">shells</span> <span class="o">=</span> <span class="n">shell_map</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">basis</span><span class="p">]</span>  <span class="c1"># symbol --&gt; label</span>
            <span class="n">ustart</span> <span class="o">=</span> <span class="n">primitive_start</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">basis</span><span class="p">]</span>  <span class="c1"># symbol --&gt; label</span>
            <span class="n">uend</span> <span class="o">=</span> <span class="n">primitive_end</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">basis</span><span class="p">]</span>  <span class="c1"># symbol --&gt; label</span>
            <span class="n">nshells</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shells</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">nshells</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_count</span>
            <span class="n">atom_nprim</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nshells</span><span class="p">):</span>
                <span class="n">thisshell</span> <span class="o">=</span> <span class="n">shells</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_ao</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">ao_count</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_basis_function</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">bf_count</span>
                <span class="n">shell_nprim</span> <span class="o">=</span> <span class="n">thisshell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()</span>
                <span class="n">am</span> <span class="o">=</span> <span class="n">thisshell</span><span class="o">.</span><span class="n">am</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">shell_nprim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">am</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shell_center</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="o">=</span> <span class="n">thisshell</span><span class="o">.</span><span class="n">is_pure</span><span class="p">()</span>
                <span class="n">tst</span> <span class="o">=</span> <span class="n">ustart</span> <span class="o">+</span> <span class="n">atom_nprim</span>
                <span class="n">tsp</span> <span class="o">=</span> <span class="n">ustart</span> <span class="o">+</span> <span class="n">atom_nprim</span> <span class="o">+</span> <span class="n">shell_nprim</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">ShellInfo</span><span class="p">(</span><span class="n">am</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span><span class="p">[</span><span class="n">tst</span><span class="p">:</span><span class="n">tsp</span><span class="p">],</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span><span class="p">[</span><span class="n">tst</span><span class="p">:</span><span class="n">tsp</span><span class="p">],</span>
                                                     <span class="s1">&#39;Pure&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="k">else</span> <span class="s1">&#39;Cartesian&#39;</span><span class="p">,</span>
                                                     <span class="n">n</span><span class="p">,</span>
                                                     <span class="n">xyz_ptr</span><span class="p">,</span>
                                                     <span class="n">bf_count</span><span class="p">,</span>
                                                     <span class="n">pt</span><span class="o">=</span><span class="s1">&#39;Unnormalized&#39;</span><span class="p">,</span>
                                                     <span class="n">rpowers</span><span class="o">=</span><span class="n">rpowers</span><span class="p">[</span><span class="n">tst</span><span class="p">:</span><span class="n">tsp</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">thisbf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thisshell</span><span class="o">.</span><span class="n">nfunction</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">function_to_shell</span><span class="p">[</span><span class="n">bf_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_count</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">function_center</span><span class="p">[</span><span class="n">bf_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
                    <span class="n">bf_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">thisao</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">thisshell</span><span class="o">.</span><span class="n">ncartesian</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ao_to_shell</span><span class="p">[</span><span class="n">ao_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_count</span>
                    <span class="n">ao_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">atom_nprim</span> <span class="o">+=</span> <span class="n">shell_nprim</span>
                <span class="n">shell_count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">atom_nprim</span> <span class="o">!=</span> <span class="n">uend</span> <span class="o">-</span> <span class="n">ustart</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Problem with nprimitive in basis set construction!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.constructor_basisset_center"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.constructor_basisset_center">[docs]</a>    <span class="k">def</span> <span class="nf">constructor_basisset_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bs</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        * Creates a new basis set object for an atom, from an existing basis set</span>
<span class="sd">        * bs: the basis set to copy data from</span>
<span class="sd">        * center: the atom in bs to copy over</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Singletons; these should&#39;ve been initialized by this point, but just in case</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_shared</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_singletons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_shared</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># First, find the shells we need, and grab the data</span>
        <span class="n">uexps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ucoefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">uoriginal_coefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">uerd_coefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">shelln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">nshell</span><span class="p">()):</span>
            <span class="n">shell</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">shell</span><span class="p">(</span><span class="n">shelln</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shell</span><span class="o">.</span><span class="n">ncenter</span><span class="p">()</span> <span class="o">==</span> <span class="n">center</span><span class="p">:</span>
                <span class="n">nprim</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">prim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprim</span><span class="p">):</span>
                    <span class="n">uexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                    <span class="n">ucoefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">coef</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                    <span class="n">uoriginal_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">original_coef</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                    <span class="n">uerd_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">erd_coef</span><span class="p">(</span><span class="n">prim</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span> <span class="o">+=</span> <span class="n">shell</span><span class="o">.</span><span class="n">ncartesian</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span> <span class="o">+=</span> <span class="n">shell</span><span class="o">.</span><span class="n">nfunction</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYnprimitive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>

        <span class="c1"># Create a &quot;molecule&quot;, i.e., an atom, with 1 fragment</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">molecule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">Molecule</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">center</span><span class="p">)],</span>
                                             <span class="n">geom</span><span class="o">=</span><span class="n">mol</span><span class="o">.</span><span class="n">xyz</span><span class="p">(</span><span class="n">center</span><span class="p">),</span>
                                             <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Bohr&#39;</span><span class="p">,</span>
                                             <span class="n">fix_com</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Allocate arrays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_prim_per_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="c1"># The unique primitives</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ucoefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uerd_coefficients</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_uprimitive</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uexps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ucoefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ucoefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uoriginal_coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uerd_coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">uerd_coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_ao</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_basis_function</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shells</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ao_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shell_center</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">xyz</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>

        <span class="c1"># Now loop over shell for this atom, and point to the appropriate unique data</span>
        <span class="n">shell_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ao_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bf_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">prim_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">shelln</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">nshell</span><span class="p">()):</span>
            <span class="n">shell</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">shell</span><span class="p">(</span><span class="n">shelln</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">shell</span><span class="o">.</span><span class="n">ncenter</span><span class="p">()</span> <span class="o">==</span> <span class="n">center</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span>
                <span class="c1">#self.center_to_shell[0] = shell_count  # diff from libmints</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_ao</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">ao_count</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_basis_function</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">bf_count</span>
                <span class="n">shell_nprim</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()</span>
                <span class="n">am</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">am</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span> <span class="o">=</span> <span class="n">shell_nprim</span> <span class="k">if</span> <span class="n">shell_nprim</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span><span class="p">,</span> <span class="n">am</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shell_center</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">center</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">is_pure</span><span class="p">()</span>
                <span class="n">tst</span> <span class="o">=</span> <span class="n">prim_count</span>
                <span class="n">tsp</span> <span class="o">=</span> <span class="n">prim_count</span> <span class="o">+</span> <span class="n">shell_nprim</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">ShellInfo</span><span class="p">(</span><span class="n">am</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">uoriginal_coefficients</span><span class="p">[</span><span class="n">tst</span><span class="p">:</span><span class="n">tsp</span><span class="p">],</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">uexponents</span><span class="p">[</span><span class="n">tst</span><span class="p">:</span><span class="n">tsp</span><span class="p">],</span>
                                                     <span class="s1">&#39;Pure&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="k">else</span> <span class="s1">&#39;Cartesian&#39;</span><span class="p">,</span>
                                                     <span class="n">center</span><span class="p">,</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span>
                                                     <span class="n">bf_count</span><span class="p">,</span>
                                                     <span class="n">pt</span><span class="o">=</span><span class="s1">&#39;Unnormalized&#39;</span><span class="p">,</span>
                                                     <span class="n">rpowers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_count</span><span class="p">]</span><span class="o">.</span><span class="n">pyprint</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">thisbf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">nfunction</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">function_to_shell</span><span class="p">[</span><span class="n">bf_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_count</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">function_center</span><span class="p">[</span><span class="n">bf_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">center</span>
                    <span class="n">bf_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">thisao</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">ncartesian</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ao_to_shell</span><span class="p">[</span><span class="n">ao_count</span><span class="p">]</span> <span class="o">=</span> <span class="n">shell_count</span>
                    <span class="n">ao_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">shell_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">prim_count</span> <span class="o">+=</span> <span class="n">shell_nprim</span></div>

    <span class="c1"># &lt;&lt;&lt; Methods for Construction by Another Name &gt;&gt;&gt;</span>

<div class="viewcode-block" id="BasisSet.zero_ao_basis_set"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.zero_ao_basis_set">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">zero_ao_basis_set</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;Returns an empty basis set object.</span>
<span class="sd">        Returns a BasisSet object that actually has a single s-function</span>
<span class="sd">        at the origin with an exponent of 0.0 and contraction of 1.0.</span>
<span class="sd">        *  @return A new empty BasisSet object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># In the new implementation, we simply call the default constructor</span>
        <span class="k">return</span> <span class="n">BasisSet</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasisSet.atomic_basis_set"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.atomic_basis_set">[docs]</a>    <span class="k">def</span> <span class="nf">atomic_basis_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a BasisSet object containing all shells at center i (0-index)</span>
<span class="sd">        * Used for Atomic HF computations for SAD Guesses</span>
<span class="sd">        * @param center Atomic center to provide a basis object for.</span>
<span class="sd">        * @returns A new basis set object for the atomic center.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">BasisSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.build"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.build">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">molecule</span><span class="p">,</span> <span class="n">shells</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builder factory method</span>
<span class="sd">        * @param molecule the molecule to build the BasisSet around</span>
<span class="sd">        * @param shells array of *atom-numbered* ShellInfo to build the BasisSet from</span>
<span class="sd">        * @return BasisSet corresponding to this molecule and set of shells</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">FeatureNotImplemented</span><span class="p">(</span><span class="s1">&#39;BasisSet::build&#39;</span><span class="p">)</span></div>

<span class="c1">#TRIAL#    @staticmethod</span>
<span class="c1">#TRIAL#    def pyconstruct_combined(mol, keys, targets, fitroles, others):</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        # make sure the lengths are all the same</span>
<span class="c1">#TRIAL#        if len(keys) != len(targets) or len(keys) != len(fitroles):</span>
<span class="c1">#TRIAL#            raise ValidationError(&quot;&quot;&quot;Lengths of keys, targets, and fitroles must be equal&quot;&quot;&quot;)</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        # Create (if necessary) and update qcdb.Molecule</span>
<span class="c1">#TRIAL#        if isinstance(mol, basestring):</span>
<span class="c1">#TRIAL#            mol = Molecule(mol)</span>
<span class="c1">#TRIAL#            returnBasisSet = False</span>
<span class="c1">#TRIAL#        elif isinstance(mol, Molecule):</span>
<span class="c1">#TRIAL#            returnBasisSet = True</span>
<span class="c1">#TRIAL#        else:</span>
<span class="c1">#TRIAL#            raise ValidationError(&quot;&quot;&quot;Argument mol must be psi4string or qcdb.Molecule&quot;&quot;&quot;)</span>
<span class="c1">#TRIAL#        mol.update_geometry()</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        # load in the basis sets</span>
<span class="c1">#TRIAL#        sets = []</span>
<span class="c1">#TRIAL#        name = &quot;&quot;</span>
<span class="c1">#TRIAL#        for at in range(len(keys)):</span>
<span class="c1">#TRIAL#            bas = BasisSet.pyconstruct(mol, keys[at], targets[at], fitroles[at], others[at])</span>
<span class="c1">#TRIAL#            name += targets[at] + &quot; + &quot;</span>
<span class="c1">#TRIAL#            sets.append(bas)</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        name = name[:-3].strip()</span>
<span class="c1">#TRIAL#        # work our way through the sets merging them</span>
<span class="c1">#TRIAL#        combined_atom_basis_shell = OrderedDict()</span>
<span class="c1">#TRIAL#        for at in range(len(sets)):</span>
<span class="c1">#TRIAL#            atom_basis_shell = sets[at].atom_basis_shell</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#            for label, basis_map in atom_basis_shell.items():</span>
<span class="c1">#TRIAL#                if label not in combined_atom_basis_shell:</span>
<span class="c1">#TRIAL#                    combined_atom_basis_shell[label] = OrderedDict()</span>
<span class="c1">#TRIAL#                    combined_atom_basis_shell[label][name] = []</span>
<span class="c1">#TRIAL#                for basis, shells in basis_map.items():</span>
<span class="c1">#TRIAL#                    combined_atom_basis_shell[label][name].extend(shells)</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        #for label, basis_map in combined_atom_basis_shell.items():</span>
<span class="c1">#TRIAL#        #    # sort the shells by angular momentum</span>
<span class="c1">#TRIAL#        #    combined_atom_basis_shell[label][name] = sorted(combined_atom_basis_shell[label][name], key=lambda shell: she</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        # Molecule and parser prepped, call the constructor</span>
<span class="c1">#TRIAL#        mol.set_basis_all_atoms(name, &quot;CABS&quot;)</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        # Construct the grand BasisSet for mol</span>
<span class="c1">#TRIAL#        basisset = BasisSet(&quot;CABS&quot;, mol, combined_atom_basis_shell)</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        # Construct all the one-atom BasisSet-s for mol&#39;s CoordEntry-s</span>
<span class="c1">#TRIAL#        for at in range(mol.natom()):</span>
<span class="c1">#TRIAL#            oneatombasis = BasisSet(basisset, at)</span>
<span class="c1">#TRIAL#            oneatombasishash = hashlib.sha1(oneatombasis.print_detail(numbersonly=True).encode(&#39;utf-8&#39;)).hexdigest()</span>
<span class="c1">#TRIAL#            mol.set_shell_by_number(at, oneatombasishash, role=&quot;CABS&quot;)</span>
<span class="c1">#TRIAL#        mol.update_geometry()  # re-evaluate symmetry taking basissets into account</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        text = &quot;&quot;&quot;   =&gt; Creating Basis Set &lt;=\n\n&quot;&quot;&quot;</span>
<span class="c1">#TRIAL#        text += &quot;&quot;&quot;    Role: %s\n&quot;&quot;&quot; % (fitroles)</span>
<span class="c1">#TRIAL#        text += &quot;&quot;&quot;    Keyword: %s\n&quot;&quot;&quot; % (keys)</span>
<span class="c1">#TRIAL#        text += &quot;&quot;&quot;    Name: %s\n&quot;&quot;&quot; % (name)</span>
<span class="c1">#TRIAL#</span>
<span class="c1">#TRIAL#        if returnBasisSet:</span>
<span class="c1">#TRIAL#            print(text)</span>
<span class="c1">#TRIAL#            return basisset</span>
<span class="c1">#TRIAL#        else:</span>
<span class="c1">#TRIAL#            bsdict = {}</span>
<span class="c1">#TRIAL#            bsdict[&#39;message&#39;] = text</span>
<span class="c1">#TRIAL#            bsdict[&#39;name&#39;] = basisset.name</span>
<span class="c1">#TRIAL#            bsdict[&#39;puream&#39;] = int(basisset.has_puream())</span>
<span class="c1">#TRIAL#            bsdict[&#39;shell_map&#39;] = basisset.export_for_libmints(&quot;CABS&quot;)</span>
<span class="c1">#TRIAL#            return bsdict</span>

<div class="viewcode-block" id="BasisSet.pyconstruct"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.pyconstruct">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">pyconstruct</span><span class="p">(</span><span class="n">mol</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Molecule</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span>
                    <span class="n">fitrole</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ORBITAL&#39;</span><span class="p">,</span>
                    <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">return_atomlist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">return_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Builds a BasisSet object for *mol* (either a qcdb.Molecule or</span>
<span class="sd">        a string that can be instantiated into one) from basis set</span>
<span class="sd">        specifications passed in as python functions or as a string that</span>
<span class="sd">        names a basis to be applied to all atoms. Always required is the</span>
<span class="sd">        keyword *key* and string/function *target* of the basis to be</span>
<span class="sd">        constructed. For orbital basis sets, *key* will likely be &#39;BASIS&#39;</span>
<span class="sd">        and, together with *target*, these arguments suffice.</span>
<span class="sd">        ``pyconstruct(smol, &quot;BASIS&quot;, basisspec_psi4_yo_631pg_d_p_)``</span>
<span class="sd">        ``pyconstruct(mol, &quot;BASIS&quot;, &quot;6-31+G**&quot;)``</span>
<span class="sd">        When building an auxiliary basis, *key* is again the keyword,</span>
<span class="sd">        *target* is the string or function for the fitting basis (this</span>
<span class="sd">        may also be an empty string). In case the fitting basis isn&#39;t</span>
<span class="sd">        fully specified, also provide a *fitrole* and the string/function</span>
<span class="sd">        of the orbital basis as *other*, so that orbital hints can be</span>
<span class="sd">        used to look up a suitable default basis in BasisFamily.</span>
<span class="sd">        ``pyconstruct(smol, &quot;DF_BASIS_MP2&quot;, basisspec_psi4_yo_ccpvdzri, &#39;RIFIT&#39;, basisspec_psi4_yo_631pg_d_p_)``</span>
<span class="sd">        ``pyconstruct(mol, &quot;DF_BASIS_MP2&quot;, &quot;&quot;, &quot;RIFIT&quot;, &quot;6-31+G(d,p)&quot;)``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mol</span>
<span class="sd">            If not a :py:class:`qcdb.Molecule`, something that can be converted into one.</span>
<span class="sd">            If the latter, the basisset dict is returned rather than the BasisSet object.</span>
<span class="sd">            If you&#39;ve got a psi4.core.Molecule, pass `qcdb.Molecule(psimol.to_dict())`.</span>
<span class="sd">        key</span>
<span class="sd">            {&#39;BASIS&#39;, &#39;DF_BASIS_SCF&#39;, &#39;DF_BASIS_MP2&#39;, &#39;DF_BASIS_CC&#39;}</span>
<span class="sd">            Label (effectively Psi4 keyword) to append the basis on the molecule.</span>
<span class="sd">        target</span>
<span class="sd">            Defines the basis set to be constructed. Can be a string (naming a</span>
<span class="sd">            basis file) or a function (multiple files, shells).</span>
<span class="sd">            Required for `fitrole=&#39;ORBITAL&#39;`. For auxiliary bases to be built</span>
<span class="sd">            entirely from orbital default, can be empty string.</span>
<span class="sd">        fitrole</span>
<span class="sd">            {&#39;ORBITAL&#39;, &#39;JKFIT&#39;, &#39;RIFIT&#39;}</span>
<span class="sd">        other</span>
<span class="sd">            Only used when building fitting bases. Like `target` only supplies</span>
<span class="sd">            the definitions for the orbital basis.</span>
<span class="sd">        return_atomlist</span>
<span class="sd">            Build one-atom basis sets (for SAD) rather than one whole-Mol basis set</span>
<span class="sd">        return_dict</span>
<span class="sd">            Additionally return the dictionary representation of built BasisSet</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bas : :py:class:`qcdb.BasisSet`</span>
<span class="sd">            Built BasisSet object for `mol`.</span>
<span class="sd">        dbas : dict, optional</span>
<span class="sd">            Only returned if `return_dict=True`. Suitable for feeding to libmints.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orbonly</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">fitrole</span> <span class="o">==</span> <span class="s1">&#39;ORBITAL&#39;</span> <span class="ow">and</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">orbonly</span><span class="p">:</span>
            <span class="n">orb</span> <span class="o">=</span> <span class="n">target</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orb</span> <span class="o">=</span> <span class="n">other</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="n">target</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BasisSet::pyconstructP&#39;</span><span class="p">,</span> <span class="s1">&#39;key =&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;aux =&#39;</span><span class="p">,</span> <span class="n">aux</span><span class="p">,</span> <span class="s1">&#39;fitrole =&#39;</span><span class="p">,</span> <span class="n">fitrole</span><span class="p">,</span> <span class="s1">&#39;orb =&#39;</span><span class="p">,</span> <span class="n">orb</span><span class="p">,</span>
                  <span class="s1">&#39;orbonly =&#39;</span><span class="p">,</span> <span class="n">orbonly</span><span class="p">)</span>  <span class="c1">#, mol)</span>

        <span class="c1"># Create (if necessary) and update qcdb.Molecule</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">Molecule</span><span class="p">):</span>
            <span class="n">mol</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>

        <span class="c1"># Apply requested basis set(s) to the molecule</span>
        <span class="c1">#   - basstrings only a temp object so using fitrole as dict key instead of psi4 keyword</span>
        <span class="c1">#   - error checking not needed since C-side already checked for NULL ptr</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">clear_basis_all_atoms</span><span class="p">()</span>
        <span class="c1"># TODO now need to clear shells, too</span>
        <span class="n">basstrings</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">orb</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Orbital basis argument must not be empty.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">orb</span><span class="p">):</span>
            <span class="n">basstrings</span><span class="p">[</span><span class="s1">&#39;BASIS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orb</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;BASIS&#39;</span><span class="p">)</span>
            <span class="n">callby</span> <span class="o">=</span> <span class="n">orb</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;basisspec_psi4_yo__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">orb</span> <span class="ow">in</span> <span class="n">basishorde</span><span class="p">:</span>
            <span class="n">basstrings</span><span class="p">[</span><span class="s1">&#39;BASIS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">basishorde</span><span class="p">[</span><span class="n">orb</span><span class="p">](</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;BASIS&#39;</span><span class="p">)</span>
            <span class="n">callby</span> <span class="o">=</span> <span class="n">orb</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">orb</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">set_basis_all_atoms</span><span class="p">(</span><span class="n">orb</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s1">&#39;BASIS&#39;</span><span class="p">)</span>
            <span class="n">callby</span> <span class="o">=</span> <span class="n">orb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Orbital basis argument must be function that applies basis sets to Molecule or a string of the basis to be applied to all atoms.&quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">orbonly</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aux</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">aux</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">callby</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">{}</span><span class="s1"> Aux)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">callby</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">aux</span><span class="p">):</span>
                <span class="n">basstrings</span><span class="p">[</span><span class="n">fitrole</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">fitrole</span><span class="p">)</span>
                <span class="n">callby</span> <span class="o">=</span> <span class="n">aux</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;basisspec_psi4_yo__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">mol</span><span class="o">.</span><span class="n">set_basis_all_atoms</span><span class="p">(</span><span class="n">aux</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">fitrole</span><span class="p">)</span>
                <span class="n">callby</span> <span class="o">=</span> <span class="n">aux</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;Auxiliary basis argument must be function that applies basis sets to Molecule or a string of the basis to be applied to all atoms.&quot;&quot;&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Not like we&#39;re ever using a non-G94 format</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">Gaussian94BasisSetParser</span><span class="p">()</span>

        <span class="c1"># Molecule and parser prepped, call the constructor</span>
        <span class="n">bs</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">ecp</span> <span class="o">=</span> <span class="n">BasisSet</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span>
                                          <span class="n">mol</span><span class="p">,</span>
                                          <span class="s1">&#39;BASIS&#39;</span> <span class="k">if</span> <span class="n">fitrole</span> <span class="o">==</span> <span class="s1">&#39;ORBITAL&#39;</span> <span class="k">else</span> <span class="n">fitrole</span><span class="p">,</span>
                                          <span class="kc">None</span> <span class="k">if</span> <span class="n">fitrole</span> <span class="o">==</span> <span class="s1">&#39;ORBITAL&#39;</span> <span class="k">else</span> <span class="n">fitrole</span><span class="p">,</span>
                                          <span class="n">basstrings</span><span class="p">[</span><span class="s1">&#39;BASIS&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">fitrole</span> <span class="o">==</span> <span class="s1">&#39;ORBITAL&#39;</span> <span class="k">else</span> <span class="n">basstrings</span><span class="p">[</span><span class="n">fitrole</span><span class="p">],</span>
                                          <span class="n">return_atomlist</span><span class="o">=</span><span class="n">return_atomlist</span><span class="p">,</span>
                                          <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;   =&gt; Loading Basis Set &lt;=</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Name: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">callby</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Role: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fitrole</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Keyword: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="n">msg</span>

        <span class="k">if</span> <span class="n">return_atomlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
                <span class="n">atom_basis_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">atbs</span> <span class="ow">in</span> <span class="n">bs</span><span class="p">:</span>
                    <span class="n">bsdict</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>
                    <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">callby</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;blend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atbs</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                    <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;puream&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">atbs</span><span class="o">.</span><span class="n">has_puream</span><span class="p">())</span>
                    <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;shell_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atbs</span><span class="o">.</span><span class="n">export_for_libmints</span><span class="p">(</span><span class="s1">&#39;BASIS&#39;</span> <span class="k">if</span> <span class="n">fitrole</span> <span class="o">==</span> <span class="s1">&#39;ORBITAL&#39;</span> <span class="k">else</span> <span class="n">fitrole</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ecp</span><span class="p">:</span>
                        <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;ecp_shell_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecp</span><span class="o">.</span><span class="n">export_for_libmints</span><span class="p">(</span><span class="s1">&#39;BASIS&#39;</span><span class="p">)</span>
                    <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;molecule&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atbs</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">force_c1</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">atom_basis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bsdict</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">bs</span><span class="p">,</span> <span class="n">atom_basis_list</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">bs</span>

        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
            <span class="n">bsdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>
            <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
            <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">callby</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;blend&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;puream&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">has_puream</span><span class="p">())</span>
            <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;shell_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">export_for_libmints</span><span class="p">(</span><span class="s1">&#39;BASIS&#39;</span> <span class="k">if</span> <span class="n">fitrole</span> <span class="o">==</span> <span class="s1">&#39;ORBITAL&#39;</span> <span class="k">else</span> <span class="n">fitrole</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ecp</span><span class="p">:</span>
                <span class="n">bsdict</span><span class="p">[</span><span class="s1">&#39;ecp_shell_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecp</span><span class="o">.</span><span class="n">export_for_libmints</span><span class="p">(</span><span class="s1">&#39;BASIS&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">bs</span><span class="p">,</span> <span class="n">bsdict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bs</span></div>

<div class="viewcode-block" id="BasisSet.construct"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.construct">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">mol</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">deffit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">basstrings</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">return_atomlist</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a new BasisSet object configured from the *mol*</span>
<span class="sd">        Molecule object for *key* (generally a Psi4 keyword: BASIS,</span>
<span class="sd">        DF_BASIS_SCF, etc.). Fails utterly if a basis has not been set for</span>
<span class="sd">        *key* for every atom in *mol*, unless *deffit* is set (JFIT,</span>
<span class="sd">        JKFIT, or RIFIT), whereupon empty atoms are assigned to *key*</span>
<span class="sd">        from the BasisFamily. This function is significantly</span>
<span class="sd">        re-worked from its libmints analog.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mol</span>
<span class="sd">            A molecule object for which every atom has had a basisset set for `key`</span>

<span class="sd">        basstrings</span>
<span class="sd">            Additional source for basis data. Keys are regularized basis names and values are gbs strings.</span>
<span class="sd">        return_atomlist</span>
<span class="sd">            Return list of one-atom BasisSet-s, rather than single whole-mol BasisSet.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Update geometry in molecule, if there is a problem an exception is thrown.</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>

        <span class="c1"># Paths to search for gbs files: here + PSIPATH + library</span>
        <span class="c1">#try:</span>
        <span class="c1">#    from psi4 import core</span>
        <span class="c1">#    psidatadir = core.get_datadir()</span>
        <span class="c1">#except ImportError:</span>
        <span class="c1">#    psidatadir = None</span>
        <span class="c1">#    pass</span>
        <span class="c1">##nolongerenvvar psidatadir = os.environ.get(&#39;PSIDATADIR&#39;, None)</span>
        <span class="c1">##nolongerpredicatble psidatadir = __file__ + &#39;/../../..&#39; if psidatadir is None else psidatadir</span>
        <span class="c1">#if psidatadir:</span>
        <span class="c1">#    libraryPath = &#39;:&#39; + os.path.abspath(psidatadir) + &#39;/basis&#39;</span>
        <span class="c1">#else:</span>
        <span class="c1">#    libraryPath = &#39;&#39;</span>
        <span class="n">libraryPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">pe</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s1">&#39;basis&#39;</span><span class="p">])</span>
        <span class="n">basisPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> \
            <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PSIPATH&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)])</span> <span class="o">+</span> \
            <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">libraryPath</span>

        <span class="c1"># Validate deffit for key</span>
        <span class="n">univdef_zeta</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">univdef</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;JFIT&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;def2-qzvpp-jfit&#39;</span><span class="p">,</span> <span class="s1">&#39;def2-qzvpp-jfit&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s1">&#39;JKFIT&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;def2-qzvpp-jkfit&#39;</span><span class="p">,</span> <span class="s1">&#39;def2-qzvpp-jkfit&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s1">&#39;RIFIT&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;def2-qzvpp-ri&#39;</span><span class="p">,</span> <span class="s1">&#39;def2-qzvpp-ri&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s1">&#39;DECON&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">BasisSet</span><span class="o">.</span><span class="n">decontract</span><span class="p">),</span>
            <span class="s1">&#39;F12&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;def2-qzvpp-f12&#39;</span><span class="p">,</span> <span class="s1">&#39;def2-qzvpp-f12&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">deffit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deffit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">univdef</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;BasisSet::construct: deffit argument invalid: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">deffit</span><span class="p">))</span>

        <span class="c1"># Map of ShellInfo</span>
        <span class="n">atom_basis_shell</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">ecp_atom_basis_shell</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">ecp_atom_basis_ncore</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bastitles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natom</span><span class="p">()):</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_entry</span><span class="p">(</span><span class="n">at</span><span class="p">)</span><span class="o">.</span><span class="n">symbol</span><span class="p">()</span>  <span class="c1"># O, He</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_entry</span><span class="p">(</span><span class="n">at</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">()</span>  <span class="c1"># O3, C_Drot, He</span>
            <span class="n">basdict</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">atom_entry</span><span class="p">(</span><span class="n">at</span><span class="p">)</span><span class="o">.</span><span class="n">basissets</span><span class="p">()</span>  <span class="c1"># {&#39;BASIS&#39;: &#39;sto-3g&#39;, &#39;DF_BASIS_MP2&#39;: &#39;cc-pvtz-ri&#39;}</span>

            <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">atom_basis_shell</span><span class="p">:</span>
                <span class="n">atom_basis_shell</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ecp_atom_basis_shell</span><span class="p">:</span>
                <span class="n">ecp_atom_basis_shell</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>

            <span class="c1"># Establish search parameters for what/where basis entries suitable for atom</span>
            <span class="n">seek</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">requested_basname</span> <span class="o">=</span> <span class="n">basdict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;BASIS&#39;</span> <span class="ow">or</span> <span class="n">deffit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">BasisSetNotDefined</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;BasisSet::construct: No basis set specified for </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">.&quot;&quot;&quot;</span> <span class="o">%</span>
                                             <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># No auxiliary basis set for atom, so try darnedest to find one.</span>
                    <span class="c1">#   This involves querying the BasisFamily for default and</span>
                    <span class="c1">#   default-default and finally the universal default (defined</span>
                    <span class="c1">#   in this function). Since user hasn&#39;t indicated any specifics,</span>
                    <span class="c1">#   look only in Psi4&#39;s library and for symbol only, not label.</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corresponding_basis</span><span class="p">(</span><span class="n">basdict</span><span class="p">[</span><span class="s1">&#39;BASIS&#39;</span><span class="p">],</span> <span class="n">deffit</span><span class="p">))</span>
                    <span class="c1">#NYI#tmp.append(corresponding_basis(basdict[&#39;BASIS&#39;], deffit + &#39;-DEFAULT&#39;))</span>
                    <span class="n">orbital_zeta</span> <span class="o">=</span> <span class="n">corresponding_zeta</span><span class="p">(</span><span class="n">basdict</span><span class="p">[</span><span class="s1">&#39;BASIS&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">orbital_zeta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">orbital_zeta</span> <span class="o">&lt;=</span> <span class="n">univdef_zeta</span><span class="p">:</span>
                        <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">univdef</span><span class="p">[</span><span class="n">deffit</span><span class="p">])</span>
                    <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;basis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tmp</span> <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
                    <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbol</span><span class="p">]</span>
                    <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libraryPath</span>
                    <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;strings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># User (I hope ... dratted has_changed) has set basis for atom,</span>
                <span class="c1">#   so look only for basis (don&#39;t try defaults), look for label (N88)</span>
                <span class="c1">#   or symbol (N) (in that order; don&#39;t want to restrict use of atom</span>
                <span class="c1">#   labels to basis set spec), look everywhere (don&#39;t just look</span>
                <span class="c1">#   in library)</span>
                <span class="k">if</span> <span class="n">requested_basname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;-decon&#39;</span><span class="p">):</span>
                    <span class="n">bas_recipe</span> <span class="o">=</span> <span class="n">requested_basname</span><span class="p">,</span> <span class="n">requested_basname</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">],</span> <span class="n">BasisSet</span><span class="o">.</span><span class="n">decontract</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bas_recipe</span> <span class="o">=</span> <span class="n">requested_basname</span><span class="p">,</span> <span class="n">requested_basname</span><span class="p">,</span> <span class="kc">None</span>
                <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;basis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">bas_recipe</span><span class="p">]</span>
                <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">symbol</span><span class="p">]</span> <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="n">label</span> <span class="k">else</span> <span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="n">symbol</span><span class="p">]</span>
                <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">basisPath</span>
                <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;strings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">basstrings</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">basstrings</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  Shell Entries: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">seek</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  Basis Sets: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">seek</span><span class="p">[</span><span class="s1">&#39;basis&#39;</span><span class="p">]))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  File Path: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)))))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  Input Blocks: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seek</span><span class="p">[</span><span class="s1">&#39;strings&#39;</span><span class="p">])))</span>

            <span class="c1"># Search through paths, bases, entries</span>
            <span class="k">for</span> <span class="n">bas</span> <span class="ow">in</span> <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;basis&#39;</span><span class="p">]:</span>
                <span class="p">(</span><span class="n">bastitle</span><span class="p">,</span> <span class="n">basgbs</span><span class="p">,</span> <span class="n">postfunc</span><span class="p">)</span> <span class="o">=</span> <span class="n">bas</span>

                <span class="n">filename</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">make_filename</span><span class="p">(</span><span class="n">basgbs</span><span class="p">)</span>
                <span class="c1"># -- First seek bas string in input file strings</span>
                <span class="k">if</span> <span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;strings&#39;</span><span class="p">]:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;inputblock </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
                    <span class="c1"># Store contents</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                        <span class="n">names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">basstrings</span><span class="p">[</span><span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># -- Else seek bas.gbs file in path</span>
                    <span class="n">fullfilename</span> <span class="o">=</span> <span class="n">search_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">fullfilename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># -- Else skip to next bas</span>
                        <span class="k">continue</span>
                    <span class="c1"># Store contents so not reloading files</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="s1">&#39;file </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullfilename</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                        <span class="n">names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">fullfilename</span><span class="p">)</span>

                <span class="n">lines</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]:</span>

                    <span class="c1"># Seek entry in lines, else skip to next entry</span>
                    <span class="n">shells</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">ecp_shells</span><span class="p">,</span> <span class="n">ecp_msg</span><span class="p">,</span> <span class="n">ecp_ncore</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">shells</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># Found!</span>
                    <span class="c1"># -- Post-process</span>
                    <span class="k">if</span> <span class="n">postfunc</span><span class="p">:</span>
                        <span class="n">shells</span> <span class="o">=</span> <span class="n">postfunc</span><span class="p">(</span><span class="n">shells</span><span class="p">)</span>
                        <span class="n">fmsg</span> <span class="o">=</span> <span class="s1">&#39;func </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">postfunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fmsg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="c1"># -- Assign to Molecule</span>
                    <span class="n">atom_basis_shell</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">bastitle</span><span class="p">]</span> <span class="o">=</span> <span class="n">shells</span>
                    <span class="n">ecp_atom_basis_shell</span><span class="p">[</span><span class="n">label</span><span class="p">][</span><span class="n">bastitle</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecp_shells</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;BASIS&#39;</span><span class="p">:</span>
                        <span class="n">ecp_atom_basis_ncore</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">ecp_ncore</span>
                    <span class="n">mol</span><span class="o">.</span><span class="n">set_basis_by_number</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">bastitle</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">bastitles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bastitle</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">ecp_msg</span><span class="p">:</span>
                        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;entry </span><span class="si">%-10s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> (ECP: </span><span class="si">%s</span><span class="s2">) </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">ecp_msg</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">fmsg</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;entry </span><span class="si">%-10s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">fmsg</span><span class="p">))</span>
                    <span class="k">break</span>

                <span class="c1"># Break from outer loop if inner loop breaks</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">break</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Ne&#39;er found :-(</span>
                <span class="n">text2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;  Shell Entries: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">seek</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">])</span>
                <span class="n">text2</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;  Basis Sets: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">seek</span><span class="p">[</span><span class="s1">&#39;basis&#39;</span><span class="p">])</span>
                <span class="n">text2</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;  File Path: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">seek</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">))))</span>
                <span class="n">text2</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;  Input Blocks: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">seek</span><span class="p">[</span><span class="s1">&#39;strings&#39;</span><span class="p">]))</span>
                <span class="k">raise</span> <span class="n">BasisSetNotFound</span><span class="p">(</span><span class="s1">&#39;BasisSet::construct: Unable to find a basis set for atom </span><span class="si">%d</span><span class="s1"> for key </span><span class="si">%s</span><span class="s1"> among:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="n">at</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>

        <span class="c1"># Construct the grand BasisSet for mol</span>
        <span class="n">basisset</span> <span class="o">=</span> <span class="n">BasisSet</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">atom_basis_shell</span><span class="p">)</span>

        <span class="c1"># If an ECP was detected, and we&#39;re building BASIS, process it now</span>
        <span class="n">ecpbasisset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ncore</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">ecp_atom_basis_ncore</span><span class="p">:</span>
            <span class="n">ncore</span> <span class="o">+=</span> <span class="n">ecp_atom_basis_ncore</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ncore</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;BASIS&#39;</span><span class="p">:</span>
            <span class="n">ecpbasisset</span> <span class="o">=</span> <span class="n">BasisSet</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">mol</span><span class="p">,</span> <span class="n">ecp_atom_basis_shell</span><span class="p">)</span>
            <span class="n">ecpbasisset</span><span class="o">.</span><span class="n">ecp_coreinfo</span> <span class="o">=</span> <span class="n">ecp_atom_basis_ncore</span>

        <span class="c1"># Construct all the one-atom BasisSet-s for mol&#39;s CoordEntry-s</span>
        <span class="n">atom_basis_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">natom</span><span class="p">()):</span>
            <span class="n">oneatombasis</span> <span class="o">=</span> <span class="n">BasisSet</span><span class="p">(</span><span class="n">basisset</span><span class="p">,</span> <span class="n">at</span><span class="p">)</span>
            <span class="n">oneatombasishash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">oneatombasis</span><span class="o">.</span><span class="n">print_detail</span><span class="p">(</span><span class="n">numbersonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">return_atomlist</span><span class="p">:</span>
                <span class="n">oneatombasis</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">set_shell_by_number</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">oneatombasishash</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
                <span class="n">atom_basis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oneatombasis</span><span class="p">)</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">set_shell_by_number</span><span class="p">(</span><span class="n">at</span><span class="p">,</span> <span class="n">oneatombasishash</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

        <span class="n">mol</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>  <span class="c1"># re-evaluate symmetry taking basissets into account</span>

        <span class="n">bastitles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">bastitles</span><span class="p">))</span>
        <span class="n">bastitles</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">basisset</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bastitles</span><span class="p">)</span>

        <span class="c1"># Summary printing</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">at</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary</span><span class="p">):</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">maxsats</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">msg</span><span class="p">,</span> <span class="n">ats</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="n">ats</span><span class="p">:</span>
                    <span class="n">G</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ats</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">():</span> <span class="nb">next</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span>
                    <span class="n">sats</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[:</span><span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)]))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">G</span><span class="p">)</span>
                    <span class="n">maxsats</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxsats</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sats</span><span class="p">))</span>
                    <span class="n">tmp2</span><span class="p">[</span><span class="n">sats</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">ats</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    atoms </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ats</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">maxsats</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">return_atomlist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">atom_basis_list</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">basisset</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">ecpbasisset</span></div>

    <span class="c1"># &lt;&lt;&lt; Simple Methods for Basic BasisSet Information &gt;&gt;&gt;</span>

<div class="viewcode-block" id="BasisSet.name"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.name">[docs]</a>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the name of this basis set&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="BasisSet.set_name"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the name of this basis set&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>


<span class="c1"># JET added but I think should fail</span>
<span class="c1">#+    def atom_shell_map(self):</span>
<span class="c1">#+        return self.atom_shell_map</span>

<div class="viewcode-block" id="BasisSet.nprimitive"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.nprimitive">[docs]</a>    <span class="k">def</span> <span class="nf">nprimitive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of primitives.</span>
<span class="sd">        *  @return The total number of primitives in all contractions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnprimitive</span></div>

<div class="viewcode-block" id="BasisSet.max_nprimitive"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.max_nprimitive">[docs]</a>    <span class="k">def</span> <span class="nf">max_nprimitive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Maximum number of primitives in a shell.</span>
<span class="sd">        *  Examines each shell and find the shell with the maximum number of primitives returns that</span>
<span class="sd">        *  number of primitives.</span>
<span class="sd">        *  @return Maximum number of primitives.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_nprimitive</span></div>

<div class="viewcode-block" id="BasisSet.nshell"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.nshell">[docs]</a>    <span class="k">def</span> <span class="nf">nshell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of shells.</span>
<span class="sd">        *  @return Number of shells.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_shells</span></div>

<div class="viewcode-block" id="BasisSet.nao"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.nao">[docs]</a>    <span class="k">def</span> <span class="nf">nao</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of atomic orbitals (Cartesian).</span>
<span class="sd">        * @return The number of atomic orbitals (Cartesian orbitals, always).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnao</span></div>

<div class="viewcode-block" id="BasisSet.nbf"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.nbf">[docs]</a>    <span class="k">def</span> <span class="nf">nbf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of basis functions (Spherical).</span>
<span class="sd">        *  @return The number of basis functions (Spherical, if has_puream() == true).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYnbf</span></div>

<div class="viewcode-block" id="BasisSet.max_am"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.max_am">[docs]</a>    <span class="k">def</span> <span class="nf">max_am</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Maximum angular momentum used in the basis set.</span>
<span class="sd">        *  @return Maximum angular momentum.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span></div>

<div class="viewcode-block" id="BasisSet.has_puream"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.has_puream">[docs]</a>    <span class="k">def</span> <span class="nf">has_puream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Spherical harmonics?</span>
<span class="sd">        *  @return true if using spherical harmonics</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">puream</span></div>

<div class="viewcode-block" id="BasisSet.max_function_per_shell"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.max_function_per_shell">[docs]</a>    <span class="k">def</span> <span class="nf">max_function_per_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the maximum number of basis functions contained in a shell.</span>
<span class="sd">        *  @return The max number of basis functions in a shell.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span></div>

<div class="viewcode-block" id="BasisSet.molecule"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.molecule">[docs]</a>    <span class="k">def</span> <span class="nf">molecule</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Molecule this basis is for.</span>
<span class="sd">        *  @return Shared pointer to the molecule for this basis set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span></div>

<div class="viewcode-block" id="BasisSet.shell_to_ao_function"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.shell_to_ao_function">[docs]</a>    <span class="k">def</span> <span class="nf">shell_to_ao_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a shell what is its first AO function</span>
<span class="sd">        *  @param i Shell number</span>
<span class="sd">        *  @return The function number for the first function for the i&#39;th shell.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_ao</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="BasisSet.shell_to_center"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.shell_to_center">[docs]</a>    <span class="k">def</span> <span class="nf">shell_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a shell what is its atomic center</span>
<span class="sd">        *  @param i Shell number</span>
<span class="sd">        *  @return The atomic center for the i&#39;th shell.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell_center</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="BasisSet.shell_to_basis_function"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.shell_to_basis_function">[docs]</a>    <span class="k">def</span> <span class="nf">shell_to_basis_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a shell what is its first basis function (spherical) function</span>
<span class="sd">        *  @param i Shell number</span>
<span class="sd">        *  @return The function number for the first function for the i&#39;th shell.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell_first_basis_function</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="BasisSet.function_to_shell"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.function_to_shell">[docs]</a>    <span class="k">def</span> <span class="nf">function_to_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a function number what shell does it correspond to.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_to_shell</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="BasisSet.function_to_center"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.function_to_center">[docs]</a>    <span class="k">def</span> <span class="nf">function_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a function what is its atomic center</span>
<span class="sd">        *  @param i Function number</span>
<span class="sd">        *  @return The atomic center for the i&#39;th function.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_center</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="BasisSet.ao_to_shell"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.ao_to_shell">[docs]</a>    <span class="k">def</span> <span class="nf">ao_to_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given a Cartesian function (AO) number what shell does it correspond to.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ao_to_shell</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="BasisSet.shell"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.shell">[docs]</a>    <span class="k">def</span> <span class="nf">shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">si</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the si&#39;th Gaussian shell on center</span>
<span class="sd">        *  @param i Shell number</span>
<span class="sd">        *  @return A shared pointer to the ShellInfo object for the i&#39;th shell.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">si</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">center</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">si</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">si</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">nshell</span><span class="p">():</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;BasisSet::shell(si = </span><span class="si">%d</span><span class="s2">), requested a shell out-of-bound.</span><span class="se">\n</span><span class="s2">   Max shell size: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">   Name: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="n">si</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nshell</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;BasisSet::shell: requested shell is out-of-bounds:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">si</span><span class="p">]</span></div>

<div class="viewcode-block" id="BasisSet.nshell_on_center"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.nshell_on_center">[docs]</a>    <span class="k">def</span> <span class="nf">nshell_on_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the number of shells on a given center.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="BasisSet.shell_on_center"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.shell_on_center">[docs]</a>    <span class="k">def</span> <span class="nf">shell_on_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">shell</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the overall shell number&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">center</span><span class="p">]</span> <span class="o">+</span> <span class="n">shell</span></div>

    <span class="c1"># &lt;&lt;&lt; Methods for Printing &gt;&gt;&gt;</span>

<div class="viewcode-block" id="BasisSet.print_by_level"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.print_by_level">[docs]</a>    <span class="k">def</span> <span class="nf">print_by_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print basis set information according to the level of detail in print_level</span>
<span class="sd">        @param out The file stream to use for printing. Defaults to outfile.</span>
<span class="sd">        @param print_level: defaults to 2</span>
<span class="sd">        *  &lt; 1: Nothing</span>
<span class="sd">        *    1: Brief summary</span>
<span class="sd">        *    2: Summary and contraction details</span>
<span class="sd">        *  &gt; 2: Full details</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyprint</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_detail</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.pyprint"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.pyprint">[docs]</a>    <span class="k">def</span> <span class="nf">pyprint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print the basis set.</span>
<span class="sd">        *  @param out The file stream to use for printing. Defaults to outfile.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;  Basis Set: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Number of shells: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nshell</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Number of basis function: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbf</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Number of Cartesian functions: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nao</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Spherical Harmonics?: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_puream</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Max angular momentum: </span><span class="si">%d</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_am</span><span class="p">())</span>
        <span class="c1">#text += &quot;&quot;&quot;    Source:\n%s\n&quot;&quot;&quot; % (self.source())  # TODO</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.print_summary"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.print_summary">[docs]</a>    <span class="k">def</span> <span class="nf">print_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints a short string summarizing the basis set</span>
<span class="sd">        *  @param out The file stream to use for printing. Defaults to outfile.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;  -AO BASIS SET INFORMATION:</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Name                   = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Total number of shells = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nshell</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Number of primitives   = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Number of AO           = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nao</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Number of SO           = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbf</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Maximum AM             = </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_am</span><span class="p">())</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Spherical Harmonics    = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;TRUE&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">puream</span> <span class="k">else</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;  -Contraction Scheme:</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    Atom   Type   All Primitives // Shells:</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;   ------ ------ --------------------------</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">A</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">natom</span><span class="p">()):</span>
            <span class="n">nprims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">nunique</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">nshells</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">amtypes</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    </span><span class="si">%4d</span><span class="s2">    &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%2s</span><span class="s2">     &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>

            <span class="n">first_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>
            <span class="n">n_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shell</span><span class="p">):</span>
                <span class="n">shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">Q</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span>
                <span class="n">nshells</span><span class="p">[</span><span class="n">shell</span><span class="o">.</span><span class="n">am</span><span class="p">()]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">nunique</span><span class="p">[</span><span class="n">shell</span><span class="o">.</span><span class="n">am</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">shell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()</span>
                <span class="n">nprims</span><span class="p">[</span><span class="n">shell</span><span class="o">.</span><span class="n">am</span><span class="p">()]</span> <span class="o">+=</span> <span class="n">shell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()</span>
                <span class="n">amtypes</span><span class="p">[</span><span class="n">shell</span><span class="o">.</span><span class="n">am</span><span class="p">()]</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">amchar</span><span class="p">()</span>

            <span class="c1"># All Primitives</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">nprims</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%d%c</span><span class="s2"> &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nprims</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">amtypes</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>

            <span class="c1"># Shells</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;// &quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PYmax_am</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">nshells</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%d%c</span><span class="s2"> &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nshells</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">amtypes</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.print_detail"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.print_detail">[docs]</a>    <span class="k">def</span> <span class="nf">print_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numbersonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints a detailed PSI3-style summary of the basis (per-atom)</span>
<span class="sd">        *  @param out The file stream to use for printing. Defaults to outfile.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numbersonly</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;  ==&gt; AO Basis Functions &lt;==</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    [ </span><span class="si">%s</span><span class="s2"> ]</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    spherical</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_puream</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;&quot;&quot;    cartesian</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    ****</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">uA</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">nunique</span><span class="p">()):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">uA</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numbersonly</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;   </span><span class="si">%2s</span><span class="s2"> </span><span class="si">%3d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">first_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>
            <span class="n">n_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shell</span><span class="p">):</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">Q</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">pyprint</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    ****</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.export_for_libmints"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.export_for_libmints">[docs]</a>    <span class="k">def</span> <span class="nf">export_for_libmints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;From complete BasisSet object, returns array where</span>
<span class="sd">        triplets of elements are each unique atom label, the hash</span>
<span class="sd">        of the string shells entry in gbs format and the</span>
<span class="sd">        shells entry in gbs format for that label. This packaging is</span>
<span class="sd">        intended for return to libmints BasisSet::construct_from_pydict for</span>
<span class="sd">        instantiation of a libmints BasisSet clone of *self*.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">A</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">natom</span><span class="p">()):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="n">first_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>
            <span class="n">n_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>

            <span class="n">atominfo</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="n">atominfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">.</span><span class="n">shell</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">role</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecp_coreinfo</span><span class="p">:</span>
                <span class="c1"># If core information is present, this is an ECP so we add the</span>
                <span class="c1"># number of electrons this atom&#39;s ECP basis accounts for here.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">atominfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ecp_coreinfo</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Problem with number of cores in ECP constuction!&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shell</span><span class="p">):</span>
                <span class="n">atominfo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">Q</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">aslist</span><span class="p">())</span>
            <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atominfo</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="BasisSet.print_detail_gamess"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.print_detail_gamess">[docs]</a>    <span class="k">def</span> <span class="nf">print_detail_gamess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numbersonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_list</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints a detailed PSI3-style summary of the basis (per-atom)</span>
<span class="sd">        *  @param out The file stream to use for printing. Defaults to outfile.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">blst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numbersonly</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_summary</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;  ==&gt; AO Basis Functions &lt;==</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    [ </span><span class="si">%s</span><span class="s2"> ]</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    spherical</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_puream</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;&quot;&quot;    cartesian</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;    ****</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">uA</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">nunique</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">return_list</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">uA</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numbersonly</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qcel</span><span class="o">.</span><span class="n">periodictable</span><span class="o">.</span><span class="n">to_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">A</span><span class="p">)))</span>
            <span class="n">first_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>
            <span class="n">n_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shell</span><span class="p">):</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">Q</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">pyprint_gamess</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="c1">#text += &quot;&quot;&quot;    ****\n&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">return_list</span><span class="p">:</span>
                <span class="n">blst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_list</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">blst</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.print_detail_cfour"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.print_detail_cfour">[docs]</a>    <span class="k">def</span> <span class="nf">print_detail_cfour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a string in CFOUR-style of the basis (per-atom)</span>
<span class="sd">        *  Format from http://slater.chemie.uni-mainz.de/cfour/index.php?n=Main.OldFormatOfAnEntryInTheGENBASFile</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">for</span> <span class="n">uA</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">nunique</span><span class="p">()):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">uA</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2">:CD_</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;qcdb basis </span><span class="si">%s</span><span class="s2"> for element </span><span class="si">%s</span><span class="s2"> atom </span><span class="si">%d</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">first_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>
            <span class="n">n_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>

            <span class="n">max_am_center</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shell</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">Q</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">am</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_am_center</span><span class="p">:</span>
                    <span class="n">max_am_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">Q</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">am</span><span class="p">()</span>

                <span class="c1">#max_am_center = self.shells[Q + first_shell].am() if \</span>
                <span class="c1">#self.shells[Q + first_shell].am() &gt; max_am_center else max_am_center</span>

            <span class="n">shell_per_am</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shell</span><span class="p">):</span>
                <span class="n">shell_per_am</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">Q</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">am</span><span class="p">()]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>

            <span class="c1"># Write number of shells in the basis set</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%3d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Write angular momentum for each shell</span>
            <span class="k">for</span> <span class="n">am</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%5d</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">am</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="c1"># Write number of contracted basis functions for each shell</span>
            <span class="k">for</span> <span class="n">am</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%5d</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">]))</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">exp_per_am</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">coef_per_am</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">am</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Collect unique exponents among all functions</span>
                <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">])):</span>
                    <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">Q</span><span class="p">]</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">Q</span><span class="p">]</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">K</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">]:</span>
                            <span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">Q</span><span class="p">]</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>

                <span class="c1"># Collect coefficients for each exp among all functions, zero otherwise</span>
                <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">])):</span>
                    <span class="n">K</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">])):</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">ep</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">Q</span><span class="p">]</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">K</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1.0e-8</span><span class="p">:</span>
                            <span class="n">coef_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">Q</span><span class="p">]</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">original_coef</span><span class="p">(</span><span class="n">K</span><span class="p">))</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">Q</span><span class="p">]</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">():</span>
                                <span class="n">K</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">coef_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="c1"># Write number of exponents for each shell</span>
            <span class="k">for</span> <span class="n">am</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%5d</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">]))</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

            <span class="k">for</span> <span class="n">am</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_am_center</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Write exponents for each shell</span>
                <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">])):</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%14.7f</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">ep</span><span class="p">])</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">ep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">ep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">])):</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

                <span class="c1"># Write contraction coefficients for each shell</span>
                <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">])):</span>
                    <span class="k">for</span> <span class="n">bf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shell_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">])):</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%10.7f</span><span class="s2"> &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">coef_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">bf</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">exp_per_am</span><span class="p">[</span><span class="n">am</span><span class="p">])</span> <span class="o">+</span> <span class="n">ep</span><span class="p">])</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.print_detail_nwchem"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.print_detail_nwchem">[docs]</a>    <span class="k">def</span> <span class="nf">print_detail_nwchem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">numbersonly</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints a detailed NWChem-style summary of the basis (per-atom)</span>
<span class="sd">        *  @param out The file stream to use for printing. Defaults to outfile.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">for</span> <span class="n">uA</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">nunique</span><span class="p">()):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">uA</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;# qcdb basis </span><span class="si">%s</span><span class="s2"> for element </span><span class="si">%s</span><span class="s2"> atom </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">A</span><span class="p">),</span> <span class="n">A</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">first_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_shell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>
            <span class="n">n_shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_to_nshell</span><span class="p">[</span><span class="n">A</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shell</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">numbersonly</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="si">%s%s%d</span><span class="s2"> &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">Z</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;bq&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">uA</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="c1"># TODO revisit and figure out right mixture of unique/numbered for mixed basis sets incl. ghost</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">Q</span> <span class="o">+</span> <span class="n">first_shell</span><span class="p">]</span><span class="o">.</span><span class="n">pyprint_nwchem</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
                <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>

    <span class="c1"># &lt;&lt;&lt; Misc. Methods &gt;&gt;&gt;</span>

<div class="viewcode-block" id="BasisSet.refresh"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Refresh internal basis set data. Useful if someone has pushed</span>
<span class="sd">        to shells. Pushing to shells happens in the BasisSetParsers, so</span>
<span class="sd">        the parsers will call refresh(). This function is now defunct.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">FeatureNotImplemented</span><span class="p">(</span><span class="s1">&#39;BasisSet::refresh&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.make_filename"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.make_filename">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">make_filename</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Converts basis set name to a compatible filename.</span>
<span class="sd">        * @param basisname Basis name</span>
<span class="sd">        * @return Compatible file name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Modify the name of the basis set to generate a filename: STO-3G -&gt; sto-3g</span>
        <span class="n">basisname</span> <span class="o">=</span> <span class="n">name</span>

        <span class="c1"># First make it lower case</span>
        <span class="n">basisname</span> <span class="o">=</span> <span class="n">basisname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Replace all &#39;(&#39; with &#39;_&#39;</span>
        <span class="n">basisname</span> <span class="o">=</span> <span class="n">basisname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="c1"># Replace all &#39;)&#39; with &#39;_&#39;</span>
        <span class="n">basisname</span> <span class="o">=</span> <span class="n">basisname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="c1"># Replace all &#39;,&#39; with &#39;_&#39;</span>
        <span class="n">basisname</span> <span class="o">=</span> <span class="n">basisname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>

        <span class="c1"># Replace all &#39;*&#39; with &#39;s&#39;</span>
        <span class="n">basisname</span> <span class="o">=</span> <span class="n">basisname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>

        <span class="c1"># Replace all &#39;+&#39; with &#39;p&#39;</span>
        <span class="n">basisname</span> <span class="o">=</span> <span class="n">basisname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">)</span>

        <span class="c1"># Add file extension</span>
        <span class="n">basisname</span> <span class="o">+=</span> <span class="s1">&#39;.gbs&#39;</span>

        <span class="k">return</span> <span class="n">basisname</span></div>

<div class="viewcode-block" id="BasisSet.decontract"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.decontract">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">decontract</span><span class="p">(</span><span class="n">shells</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Procedure applied to list to ShellInfo-s *shells* that returns</span>
<span class="sd">        another list of shells, one for every AM and exponent pair in the input</span>
<span class="sd">        list. Decontracts the shells.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># vector of uncontracted shells to return</span>
        <span class="n">shell_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># map of AM to a vector of exponents for duplicate basis functions check</span>
        <span class="n">exp_map</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">shell</span> <span class="ow">in</span> <span class="n">shells</span><span class="p">:</span>
            <span class="n">am</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">am</span><span class="p">()</span>
            <span class="n">pure</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">is_pure</span><span class="p">()</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">ncenter</span><span class="p">()</span>
            <span class="n">center</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">center</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">start</span>

            <span class="k">for</span> <span class="n">prim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()):</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">prim</span><span class="p">)</span>
                <span class="n">unique</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">for</span> <span class="n">_exp</span> <span class="ow">in</span> <span class="n">exp_map</span><span class="p">[</span><span class="n">am</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">exp</span> <span class="o">-</span> <span class="n">_exp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-6</span><span class="p">:</span>
                        <span class="n">unique</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
                    <span class="n">us</span> <span class="o">=</span> <span class="n">ShellInfo</span><span class="p">(</span><span class="n">am</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="n">exp</span><span class="p">],</span> <span class="s1">&#39;Pure&#39;</span> <span class="k">if</span> <span class="n">pure</span> <span class="k">else</span> <span class="s1">&#39;Cartesian&#39;</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span>
                                   <span class="s1">&#39;Unnormalized&#39;</span><span class="p">)</span>
                    <span class="n">shell_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
                    <span class="n">exp_map</span><span class="p">[</span><span class="n">am</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">shell_list</span></div>

    <span class="c1"># &lt;&lt;&lt; Methods not Implemented &gt;&gt;&gt;</span>

<div class="viewcode-block" id="BasisSet.zero_so_basis_set"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.zero_so_basis_set">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">zero_so_basis_set</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">factory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; **NYI** Returns an empty SO basis set object.</span>
<span class="sd">        *  Returns an SOBasis object that actually has a single s-function</span>
<span class="sd">        *  at the origin with an exponent of 0.0 and contraction of 1.0.</span>
<span class="sd">        *  @return A new empty SOBasis object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">FeatureNotImplemented</span><span class="p">(</span><span class="s1">&#39;BasisSet::zero_so_basis_set&#39;</span><span class="p">)</span>  <span class="c1"># FINAL</span></div>

<div class="viewcode-block" id="BasisSet.test_basis_set"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.test_basis_set">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">test_basis_set</span><span class="p">(</span><span class="n">max_am</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a shell-labeled test basis set object</span>
<span class="sd">        * @param max_am maximum angular momentum to build</span>
<span class="sd">        * @return pair containing shell labels and four-center</span>
<span class="sd">        * test basis for use in benchmarking</span>
<span class="sd">        * See libmints/benchmark.cc for details</span>
<span class="sd">        The libmints version seems not to have been updated along with the classes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">FeatureNotImplemented</span><span class="p">(</span><span class="s1">&#39;BasisSet::test_basis_set&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.get_ao_sorted_shell"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.get_ao_sorted_shell">[docs]</a>    <span class="k">def</span> <span class="nf">get_ao_sorted_shell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the value of the sorted shell list. Defunct&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">FeatureNotImplemented</span><span class="p">(</span><span class="s1">&#39;BasisSet::get_ao_sorted_shell&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.get_ao_sorted_list"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.get_ao_sorted_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_ao_sorted_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the vector of sorted shell list. Defunct&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">FeatureNotImplemented</span><span class="p">(</span><span class="s1">&#39;BasisSet::get_ao_sorted_list&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.compute_phi"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.compute_phi">[docs]</a>    <span class="k">def</span> <span class="nf">compute_phi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phi_ao</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the values of the basis functions at a point&quot;&quot;&quot;</span>

        <span class="n">phi_ao</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nao</span><span class="p">()</span>
        <span class="n">ao</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nshell</span><span class="p">()):</span>
            <span class="n">shell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shells</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
            <span class="n">am</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">am</span><span class="p">()</span>
            <span class="n">nprim</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">nprimitive</span><span class="p">()</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">exps</span><span class="p">()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">coefs</span><span class="p">()</span>

            <span class="n">xyz</span> <span class="o">=</span> <span class="n">shell</span><span class="o">.</span><span class="n">center</span><span class="p">()</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="n">z</span> <span class="o">-</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">dz</span>

            <span class="n">cexpr</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">np</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprim</span><span class="p">):</span>
                <span class="n">cexpr</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">np</span><span class="p">]</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="p">]</span> <span class="o">*</span> <span class="n">rr</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">INT_NCART</span><span class="p">(</span><span class="n">am</span><span class="p">)):</span>
                <span class="n">components</span> <span class="o">=</span> <span class="n">exp_ao</span><span class="p">[</span><span class="n">am</span><span class="p">][</span><span class="n">l</span><span class="p">]</span>
                <span class="n">phi_ao</span><span class="p">[</span><span class="n">ao</span> <span class="o">+</span> <span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> \
                                <span class="nb">pow</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> \
                                <span class="nb">pow</span><span class="p">(</span><span class="n">dz</span><span class="p">,</span> <span class="n">components</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> \
                                <span class="n">cexpr</span>

            <span class="n">ao</span> <span class="o">+=</span> <span class="n">INT_NCART</span><span class="p">(</span><span class="n">am</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.concatenate"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.concatenate">[docs]</a>    <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Concatenates two basis sets together into a new basis without</span>
<span class="sd">        reordering anything. Unless you know what you&#39;re doing, you should</span>
<span class="sd">        use the &#39;+&#39; operator instead of this method. Appears defunct.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">FeatureNotImplemented</span><span class="p">(</span><span class="s1">&#39;BasisSet::concatenate&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.add"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds this plus another basis set and returns the result.</span>
<span class="sd">        Equivalent to the &#39;+&#39; operator. Appears defunct.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">FeatureNotImplemented</span><span class="p">(</span><span class="s1">&#39;BasisSet::add&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasisSet.shell_sorter_ncenter"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.shell_sorter_ncenter">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">shell_sorter_ncenter</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d1</span><span class="o">.</span><span class="n">ncenter</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="o">.</span><span class="n">ncenter</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasisSet.shell_sorter_am"><a class="viewcode-back" href="../../../api/qcdb.BasisSet.html#qcdb.BasisSet.shell_sorter_am">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">shell_sorter_am</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d1</span><span class="o">.</span><span class="n">am</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="o">.</span><span class="n">am</span><span class="p">()</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../../../index.html" title="index">
          <img class="logo" src="../../../_static/qcdbsquare.png" alt="Logo"/>
        </a></p><!-- 
#
# @BEGIN LICENSE
#
# Psi4: an open-source quantum chemistry software package
#
# Copyright (c) 2007-2017 The Psi4 Developers.
#
# The copyrights for code used from other parties are included in
# the corresponding files.
#
# This file is part of Psi4.
#
# Psi4 is free software; you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, version 3.
#
# Psi4 is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public License along
# with Psi4; if not, write to the Free Software Foundation, Inc.,
# 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
#
# @END LICENSE
# -->


<div id="searchbox" style="display: none" role="search">
  <!--<h3>Quick search</h3>-->
    <form class="search" action="../../../search.html" method="get">
      <!--<div><input type="text" name="q" placeholder="search docs" /></div>-->
      <div><input type="text" name="q" placeholder="&#xF002;" style="font-family:FontAwesome, Ariel" /></div>
      <!--<div><input type="submit" value="Go" /></div>-->
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >Index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../../../index.html" title="Table Of Contents"
             ><i class="fa fa-book fa-lg"></i></a> &nbsp; &nbsp;</li>
    <li><a href="https://github.com/qcdb/qcdb/blob/master/README.md"><i class="fa fa-home fa-lg"></i></a></li>
    <li><a href="https://github.com/qcdb/qcdb"><i class="fa fa-github fa-lg"></i></a></li>
    <li><a href="http://forum.psicode.org"><i class="fa fa-comments-o fa-lg"></i></a></li>
    <li><a href="https://github.com/qcdb/qcdb/edit/master/docs/sphinx/_modules/qcdb/basisset/libmintsbasisset.rst"><i class="fa fa-pencil fa-lg"></i></a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li><a href="https://github.com/qcdb/qcdb/tree/0+untagged.1.gd9e156e">0+untagged.1.gd9e156e</a></li>
    <li style="color: #1a4162">&nbsp;&middot;&nbsp;</li>
    <li class="nav-item nav-item-0"><a href="../../../index.html">
        <span style="font-family: Optima, sans-serif;">QCDB</span>
        </a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a><i class="fa fa-angle-double-right" style="color: #a2a7b3; text-shadow: none;"></i></li>
        <li class="nav-item nav-item-this"><a href="">qcdb.basisset.libmintsbasisset</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2013-2021, The QCDB Project.
      Last updated on Sunday, 12 December 2021 11:54PM.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>